(function(){var e,a,c,f,b=function(g,h){return function(){return g.apply(h,arguments)}},d=[].indexOf||function(j){for(var h=0,g=this.length;h<g;h++){if(h in this&&this[h]===j){return h}}return -1};jQuery.fn.extend({imagepicker:function(g){if(g==null){g={}}return this.each(function(){var h;h=jQuery(this);if(h.data("picker")){h.data("picker").destroy()}h.data("picker",new e(this,f(g)));if(g.initialized!=null){return g.initialized.call(h.data("picker"))}})}});f=function(g){var h;h={hide_select:true,show_label:false,initialized:void 0,changed:void 0,clicked:void 0,selected:void 0,limit:void 0,limit_reached:void 0,base_path:void 0};return jQuery.extend(h,g)};c=function(h,g){return jQuery(h).not(g).length===0&&jQuery(g).not(h).length===0};e=(function(){function g(h,i){this.opts=i!=null?i:{};this.sync_picker_with_select=b(this.sync_picker_with_select,this);this.select=jQuery(h);this.multiple=this.select.attr("multiple")==="multiple";if(this.select.data("limit")!=null){this.opts.limit=parseInt(this.select.data("limit"))}this.build_and_append_picker()}g.prototype.destroy=function(){var i,k,h,j;j=this.picker_options;for(k=0,h=j.length;k<h;k++){i=j[k];i.destroy()}this.picker.remove();this.select.unbind("change");this.select.removeData("picker");return this.select.show()};g.prototype.build_and_append_picker=function(){var h=this;if(this.opts.hide_select){this.select.hide()}this.select.change(function(){return h.sync_picker_with_select()});if(this.picker!=null){this.picker.remove()}this.create_picker();this.select.after(this.picker);return this.sync_picker_with_select()};g.prototype.sync_picker_with_select=function(){var j,l,i,k,h;k=this.picker_options;h=[];for(l=0,i=k.length;l<i;l++){j=k[l];if(j.is_selected()){h.push(j.mark_as_selected())}else{h.push(j.unmark_as_selected())}}return h};g.prototype.create_picker=function(){this.picker=jQuery("<ul class='thumbnails image_picker_selector'></ul>");this.picker_options=[];this.recursively_parse_option_groups(this.select,this.picker);return this.picker};g.prototype.recursively_parse_option_groups=function(q,p){var h,o,r,m,l,s,i,n,k,j;n=q.children("optgroup");for(m=0,s=n.length;m<s;m++){r=n[m];r=jQuery(r);h=jQuery("<ul></ul>");h.append(jQuery("<li class='group_title'>"+(r.attr("label"))+"</li>"));p.append(jQuery("<li>").append(h));this.recursively_parse_option_groups(r,h)}k=(function(){var w,u,t,v;t=q.children("option");v=[];for(w=0,u=t.length;w<u;w++){o=t[w];v.push(new a(o,this,this.opts))}return v}).call(this);j=[];for(l=0,i=k.length;l<i;l++){o=k[l];this.picker_options.push(o);if(!o.has_image()){continue}j.push(p.append(o.node))}return j};g.prototype.has_implicit_blanks=function(){var h;return((function(){var l,j,k,i;k=this.picker_options;i=[];for(l=0,j=k.length;l<j;l++){h=k[l];if(h.is_blank()&&!h.has_image()){i.push(h)}}return i}).call(this)).length>0};g.prototype.selected_values=function(){if(this.multiple){return this.select.val()||[]}else{return[this.select.val()]}};g.prototype.toggle=function(j){var i,k,h;k=this.selected_values();h=j.value().toString();if(this.multiple){if(d.call(this.selected_values(),h)>=0){i=this.selected_values();i.splice(jQuery.inArray(h,k),1);this.select.val([]);this.select.val(i)}else{if((this.opts.limit!=null)&&this.selected_values().length>=this.opts.limit){if(this.opts.limit_reached!=null){this.opts.limit_reached.call(this.select)}}else{this.select.val(this.selected_values().concat(h))}}}else{if(this.has_implicit_blanks()&&j.is_selected()){this.select.val("")}else{this.select.val(h)}}if(!c(k,this.selected_values())){this.select.change();if(this.opts.changed!=null){return this.opts.changed.call(this.select,k,this.selected_values())}}};return g})();a=(function(){function g(i,h,j){this.picker=h;this.opts=j!=null?j:{};this.clicked=b(this.clicked,this);this.option=jQuery(i);this.create_node()}g.prototype.destroy=function(){return this.node.find(".thumbnail").unbind()};g.prototype.has_image=function(){return this.option.data("img-src")!=null};g.prototype.is_blank=function(){return !((this.value()!=null)&&this.value()!=="")};g.prototype.is_selected=function(){var h;h=this.picker.select.val();if(this.picker.multiple){return jQuery.inArray(this.value(),h)>=0}else{return this.value()===h}};g.prototype.mark_as_selected=function(){return this.node.find(".thumbnail").addClass("selected")};g.prototype.unmark_as_selected=function(){return this.node.find(".thumbnail").removeClass("selected")};g.prototype.value=function(){return this.option.val()};g.prototype.label=function(){if(this.option.data("img-label")){return this.option.data("img-label")}else{return this.option.text()}};g.prototype.clicked=function(){this.picker.toggle(this);if(this.opts.clicked!=null){this.opts.clicked.call(this.picker.select,this)}if((this.opts.selected!=null)&&this.is_selected()){return this.opts.selected.call(this.picker.select,this)}};g.prototype.create_node=function(){var h,i;this.node=jQuery("<li/>");h=jQuery("<img class='image_picker_image'/>");h.attr("src","http://myosites.com/media/thumbnail/"+this.option.data("img-src"));i=jQuery("<div class='thumbnail'>");i.click({option:this},function(j){return j.data.option.clicked()});i.append(h);if(this.opts.show_label){i.append(jQuery("<p/>").html(this.label()))}this.node.append(i);return this.node};return g})()}).call(this);